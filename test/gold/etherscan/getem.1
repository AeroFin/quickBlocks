#--
# Make params easier to read
#
filename=$3$2-$1
address=$1

#--
# Files we want to compare
#
qb_result=../monitors/txt/$filename.txt
es_result=txt/$filename.txt

#--
# We use Etherscan to verify our results, so grap the list of transactions from EtherScan
#
#./slurp_es $address $2 $3
./slurp_es.2 $address $2 $3

#--
# We need a little sed program in a file called 'z'
#
echo $1 | sed 's/0x//' >y
cat y | sed 's/^/s\/0x\//' | sed 's/$/\//' >z

#--
# Figure out if there are any records in qblock but not etherscan, then use getTrans to see if qblocks is right or wrong
#
qbnes=results/$3$2-$1_qb_not_es
echo "Looking for records in new gold that are not in old gold"
diff --suppress-common-lines -y $qb_result $es_result | grep "<" | cut  -c1-20  | cut -f1,2 | sed 's/$/ 0x/' | sed -f z | sed 's/^/.\/check_node /' >x
chmod uog+x x
./x | tee $qbnes.txt
open $qbnes.txt

#--
# Figure out if there are any records in qblock but not etherscan, then use getTrans to see if qblocks is right or wrong
#
esnqb=results/$3$2-$1_es_not_qb
echo "Looking for records from etherscan that do not appear in qblocks"
diff --suppress-common-lines -y $qb_result $es_result | grep ">" | cut -c15-100 | cut -f2,3 | sed 's/$/ 0x/' | sed -f z | sed 's/^/.\/check_node /' >x
chmod uog+x x
./x | tee $esnqb.txt
open $esnqb.txt

#--
# Finally look for records in both that are different
#
chg=results/$3$2-$1_changes
echo "Looking for common records with changes"
diff --suppress-common-lines -y $qb_result $es_result | grep "|" | tee $chg.txt
open $chg.txt

sleep 1
rm -f crap x y z
rm -f results/*ext*
rm -f results/*int*
rm -f results/*both*
